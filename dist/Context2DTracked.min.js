!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Context2DTracked=e():t.Context2DTracked=e()}(this,function(){return function(n){var i={};function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=n,o.c=i,o.i=function(t){return t},o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/",o(o.s=1)}([function(t,e,n){"use strict";var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();var a=n(2).Matrix;function s(t){return t[t.length-1]}function c(t,e,n){try{return t.call(this),n.call(this)}finally{e.call(this)}}t.exports=function(){function r(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.context=n,this.tf=[new a],this.penx=0,this.peny=0,this.justBegun=!1,this.bpenx=0,this.bpeny=0,this.ox=0,this.oy=0,this.showcontrol=!1;for(var t=["webkitImageSmoothingEnabled"],e=Object.getOwnPropertyNames(n.__proto__),i=0;i<e.length;i++){var o=e[i];0<=t.indexOf(o)||("function"==typeof n[o]?void 0===this[o]&&(this[o]=n[o].bind(n)):Object.defineProperty(this,o,{get:function(t){return n[t]}.bind(null,o),set:function(t,e){return n[t]=e}.bind(null,o)}))}}return i(r,[{key:"cf",value:function(){return s(this.tf)}},{key:"usingScaledLineWidth",value:function(t){var e=this,n=this.context.lineWidth;return c.call(this,function(){e.context.lineWidth*=Math.abs(e.cf().a)},function(){e.context.lineWidth=n},t)}},{key:"usingScaledFontSize",value:function(t){var e=this,n=this.context.font,i=n.split(" "),o=Math.round(parseInt(i[0])*Math.abs(this.cf().a));return c.call(this,function(){e.context.font=o+"px "+i[i.length-1]},function(){e.context.font=n},t)}},{key:"trace",value:function(){var t=this.penx,e=this.peny;return console.log(Math.round(10*t)/10+this.ox,Math.round(10*e)/10+this.oy),this.context.moveTo(t-5,e),this.context.lineTo(t+5,e),this.context.moveTo(t,e+5),this.context.lineTo(t,e-5),this.context.moveTo(t,e),{x:t,y:e}}},{key:"transformPoint",value:function(t,e){return s(this.tf).inverse().applyToPoint(t,e)}},{key:"transformCoordinate",value:function(t,e){return s(this.tf).applyToPoint(t,e)}},{key:"save",value:function(){this.tf.push(s(this.tf).clone()),this.context.save()}},{key:"restore",value:function(){this.tf.pop(),this.context.restore()}},{key:"scale",value:function(t,e){s(this.tf).scale(t,e)}},{key:"translate",value:function(t,e){s(this.tf).translate(t,e)}},{key:"setTransform",value:function(t,e,n,i,o,r){s(this.tf).setTransform(t,e,n,i,o,r)}},{key:"rotate",value:function(t){s(this.tf).rotate(t)}},{key:"movePen",value:function(t,e){var n=this.cf().applyToPoint(t,e);this.justBegun&&(this.justBegun=!1,this.bpenx=n.x,this.bpeny=n.y),this.penx=n.x,this.peny=n.y}},{key:"_rect",value:function(t,e,n,i,o){var r=this.cf().applyToPoint(t,e),a=this.cf().applyToPoint(n,i);o.call(this.context,r.x,r.y,a.x,a.y)}},{key:"clearRect",value:function(t,e,n,i){this._rect.apply(this,Array.prototype.slice.call(arguments).concat([this.context.clearRect]))}},{key:"fillRect",value:function(t,e,n,i){this._rect.apply(this,Array.prototype.slice.call(arguments).concat([this.context.fillRect]))}},{key:"strokeRect",value:function(t,e,n,i){var o=this,r=arguments;this.usingScaledLineWidth(function(){o._rect.apply(o,Array.prototype.slice.call(r).concat([o.context.strokeRect]))})}},{key:"rect",value:function(t,e,n,i){this._rect.apply(this,Array.prototype.slice.call(arguments).concat([this.context.rect]))}},{key:"fillText",value:function(t,e,n,i){var o=this,r=this.cf().applyToPoint(e,n);this.usingScaledFontSize(function(){o.context.fillText(t,r.x,r.y,i)})}},{key:"strokeText",value:function(t,e,n,i){var o=this,r=this.cf().applyToPoint(e,n);this.usingScaledLineWidth(function(){o.usingScaledFontSize(function(){o.context.strokeText(t,r.x,r.y,i)})})}},{key:"createLinearGradient",value:function(t,e,n,i){var o=this.cf().applyToPoint(t,e),r=this.cf().applyToPoint(n,i);return this.context.createLinearGradient(o.x,o.y,r.x,r.y)}},{key:"createRadialGradient",value:function(t,e,n,i,o,r){var a=this.cf().applyToPoint(t,e),s=this.cf().applyToPoint(i,o),c=Math.abs(this.cf().a*n),u=Math.abs(this.cf().a*r);return this.context.createRadialGradient(a.x,a.y,c,s.x,s.y,u)}},{key:"beginPath",value:function(){this.justBegun=!0,this.context.beginPath()}},{key:"moveTo",value:function(t,e){this.movePen(t,e);var n=this.cf().applyToPoint(t,e);this.context.moveTo(n.x,n.y)}},{key:"lineTo",value:function(t,e,n){var i=this.cf().applyToPoint(t,e);if(n||this.showcontrol){var o=Object.assign(this._getDefaultDebugOptions(),n);this._drawCurveControl(this._getDebugPoint(i.x,i.y),o)}this.context.lineTo(i.x,i.y),this.movePen(t,e)}},{key:"bezierCurveTo",value:function(t,e,n,i,o,r,a){var s=this.cf().applyToPoint(o,r),c=this.cf().applyToPoint(t,e),u=this.cf().applyToPoint(n,i);if(a||this.showcontrol){var h=Object.assign(this._getDefaultDebugOptions(),a);this._drawCurveControl(this._getDebugPoint(s.x,s.y,c.x,c.y,u.x,u.y),h)}this.context.bezierCurveTo(c.x,c.y,u.x,u.y,s.x,s.y),this.movePen(o,r)}},{key:"quadraticCurveTo",value:function(t,e,n,i,o){var r=this.cf().applyToPoint(n,i),a=this.cf().applyToPoint(t,e);if(o||this.showcontrol){var s=Object.assign(this._getDefaultDebugOptions(),o);this._drawCurveControl(this._getDebugPoint(r.x,r.y,a.x,a.y),s)}this.context.quadraticCurveTo(a.x,a.y,r.x,r.y),this.movePen(n,i)}},{key:"arc",value:function(t,e,n,i,o,r){var a=this.cf().applyToPoint(t,e),s=this.cf().a*n,c=a.x+Math.cos(i)*s,u=a.y+Math.sin(i)*s;this.movePen(c,u),this.context.arc(a.x,a.y,s,i,o,r);var h=a.x+Math.cos(o)*s,l=a.y+Math.sin(o)*s;this.movePen(h,l),this.bpenx=h,this.bpeny=l}},{key:"drawImage",value:function(t,e,n,i,o,r,a,s,c){var u=this.cf().applyToPoint(e,n);if(void 0!==i){var h=this.cf().applyToPoint(i,o);if(void 0!==r){var l=this.cf().applyToPoint(r,a),f=this.cf().applyToPoint(s,c);this.context.drawImage(t,u.x,u.y,h.x,h.y,l.x,l.y,f.x,f.y)}else this.context.drawImage(t,u.x,u.y,h.x,h.y)}else this.context.drawImage(t,u.x,u.y)}},{key:"putImageData",value:function(t,e,n,i,o,r,a){var s=this.cf().applyToPoint(e,n);if(void 0!==i){var c=this.cf().applyToPoint(i,o),u=this.cf().applyToPoint(r,a);this.context.putImageData(t,s.x,s.y,c.x,c.y,u.x,u.y)}else this.context.putImageData(t,s.x,s.y)}},{key:"stroke",value:function(){var t=this;"rgba(0, 0, 0, 0)"!==this.context.strokeStyle&&this.usingScaledLineWidth(function(){t.context.stroke()})}},{key:"fill",value:function(){this.movePen(this.bpenx,this.bpeny),this.context.fill.apply(this.context,arguments)}},{key:"clip",value:function(){this.movePen(this.bpenx,this.bpeny),this.context.clip.apply(this.context,arguments)}},{key:"_drawCurveControl",value:function(t,e){this.context.save();var n=[t.p1];this.context.strokeStyle=e.controlLine.color,this.context.lineWidth=e.controlLine.width,t.cp1&&(this.context.moveTo(t.p1.x,t.p1.y),this.context.lineTo(t.cp1.x,t.cp1.y),n.push(t.cp1),t.cp2?(this.context.lineTo(t.cp2.x,t.cp2.y),this.context.lineTo(t.p2.x,t.p2.y),n.push(t.cp2)):this.context.lineTo(t.p2.x,t.p2.y)),this.context.stroke(),n.push(t.p2);for(var i=0;i<n.length;++i){var o=n[i];n[i]="("+Math.round(10*n[i].x)/10+", "+Math.round(10*n[i].y)/10+")",this.context.lineWidth=e.point.width,o===t.p2?this.context.strokeStyle=e.point.destinationColor:this.context.strokeStyle=e.point.color,this.context.fillStyle=e.point.fill,this.context.beginPath(),this.context.arc(o.x,o.y,e.point.radius,0,2*Math.PI,!0),this.context.fill(),this.context.stroke()}console.log("from points",n.join(" to ")),this.context.restore(),this.context.beginPath(),this.context.moveTo(t.p1.x,t.p1.y)}},{key:"_getDebugPoint",value:function(t,e,n,i,o,r){var a={p1:{x:this.penx,y:this.peny},p2:{x:t,y:e}};return"number"==typeof n&&"number"==typeof i&&(a.cp1={x:n,y:i},"number"==typeof o&&"number"==typeof r&&(a.cp2={x:o,y:r})),a}},{key:"_getDefaultDebugOptions",value:function(){return{controlLine:{color:"rgb(200,100,100)",width:.5},point:{color:"rgb(200,50,50)",destinationColor:"#000",fill:"white",width:1,radius:1}}}}]),r}()},function(t,e,n){"use strict";t.exports=n(0)},function(t,e,n){function f(t,e){var n,i=this;i._t=i.transform,i.a=i.d=1,i.b=i.c=i.e=i.f=0,t&&(i.context=t).setTransform(1,0,0,1,0,0),Object.defineProperty(i,"element",{get:function(){return n},set:function(t){n||(i._px=i._getPX(),i.useCSS3D=!1),n=t,(i._st=n.style)[i._px]=i.toCSS()}}),e&&(i.element=e)}f.fromTriangles=function(t,e,n){var i,o,r,a,s,c,u=new f,h=new f(n);return o=Array.isArray(t)?"number"==typeof t[0]?(r=t[4],a=t[5],s=e[4],c=e[5],i=[t[0]-r,t[1]-a,t[2]-r,t[3]-a,r,a],[e[0]-s,e[1]-c,e[2]-s,e[3]-c,s,c]):(r=t[2].x,a=t[2].y,s=e[2].x,c=e[2].y,i=[t[0].x-r,t[0].y-a,t[1].x-r,t[1].y-a,r,a],[e[0].x-s,e[0].y-c,e[1].x-s,e[1].y-c,s,c]):(i=[t.px-t.rx,t.py-t.ry,t.qx-t.rx,t.qy-t.ry,t.rx,t.ry],[e.px-e.rx,e.py-e.ry,e.qx-e.rx,e.qy-e.ry,e.rx,e.ry]),u.setTransform.apply(u,i),h.setTransform.apply(h,o),h.multiply(u.inverse())},f.fromSVGTransformList=function(t,e,n){for(var i=new f(e,n),o=0;o<t.length;)i.multiply(t[o++].matrix);return i},f.from=function(t,e,n,i,o,r,a,s){var c,u,h,l=new f(a,s);if("number"==typeof t)l.setTransform(t,e,n,i,o,r);else if("number"==typeof t.x)h=Math.sqrt(t.x*t.x+t.y*t.y),c=u=1,i?c=h:u=h,l.translate(e||0,n||0).rotateFromVector(t).scaleU(c).translate(u,0);else{if("boolean"==typeof t.is2D&&!t.is2D)throw"Cannot use 3D DOMMatrix.";e&&(l.context=e),n&&(l.element=n),l.multiply(t)}return l},f.prototype={_getPX:function(){for(var t,e=["t","oT","msT","mozT","webkitT","khtmlT"],n=0,i=document.createElement("div").style;t=e[n++];)if(void 0!==i[t+"ransform"])return t+"ransform"},concat:function(t){return this.clone().multiply(t)},flipX:function(){return this._t(-1,0,0,1,0,0)},flipY:function(){return this._t(1,0,0,-1,0,0)},reflectVector:function(t,e){var n=this.applyToPoint(0,1),i=2*(n.x*t+n.y*e);return{x:t-=i*n.x,y:e-=i*n.y}},reset:function(){return this.setTransform(1,0,0,1,0,0)},rotate:function(t){var e=Math.cos(t),n=Math.sin(t);return this._t(e,n,-n,e,0,0)},rotateFromVector:function(t,e){return this.rotate("number"==typeof t?Math.atan2(e,t):Math.atan2(t.y,t.x))},rotateDeg:function(t){return this.rotate(t*Math.PI/180)},scaleU:function(t){return this._t(t,0,0,t,0,0)},scale:function(t,e){return this._t(t,0,0,e,0,0)},scaleX:function(t){return this._t(t,0,0,1,0,0)},scaleY:function(t){return this._t(1,0,0,t,0,0)},scaleFromVector:function(t,e){return this.scaleU(Math.sqrt(t*t+e*e))},shear:function(t,e){return this._t(1,e,t,1,0,0)},shearX:function(t){return this._t(1,0,t,1,0,0)},shearY:function(t){return this._t(1,t,0,1,0,0)},skew:function(t,e){return this.shear(Math.tan(t),Math.tan(e))},skewDeg:function(t,e){return this.shear(Math.tan(t/180*Math.PI),Math.tan(e/180*Math.PI))},skewX:function(t){return this.shearX(Math.tan(t))},skewY:function(t){return this.shearY(Math.tan(t))},setTransform:function(t,e,n,i,o,r){var a=this;return a.a=t,a.b=e,a.c=n,a.d=i,a.e=o,a.f=r,a._x()},translate:function(t,e){return this._t(1,0,0,1,t,e)},translateX:function(t){return this._t(1,0,0,1,t,0)},translateY:function(t){return this._t(1,0,0,1,0,t)},transform:function(t,e,n,i,o,r){var a=this,s=a.a,c=a.b,u=a.c,h=a.d,l=a.e,f=a.f;return a.a=s*t+u*e,a.b=c*t+h*e,a.c=s*n+u*i,a.d=c*n+h*i,a.e=s*o+u*r+l,a.f=c*o+h*r+f,a._x()},multiply:function(t){return this._t(t.a,t.b,t.c,t.d,t.e,t.f)},divide:function(t){return this.multiply(t.inverse())},divideScalar:function(t){var e=this;if(!t)throw"Division on zero";return e.a/=t,e.b/=t,e.c/=t,e.d/=t,e.e/=t,e.f/=t,e._x()},inverse:function(t,e){var n=this,i=new f(t?n.context:null,e?n.element:null),o=n.determinant();if(n._q(o,0))throw"Matrix not invertible.";return i.a=n.d/o,i.b=-n.b/o,i.c=-n.c/o,i.d=n.a/o,i.e=(n.c*n.f-n.d*n.e)/o,i.f=-(n.a*n.f-n.b*n.e)/o,i},interpolate:function(t,e,n,i){var o=this,r=new f(n,i);return r.a=o.a+(t.a-o.a)*e,r.b=o.b+(t.b-o.b)*e,r.c=o.c+(t.c-o.c)*e,r.d=o.d+(t.d-o.d)*e,r.e=o.e+(t.e-o.e)*e,r.f=o.f+(t.f-o.f)*e,r._x()},interpolateAnim:function(t,e,n,i){var o=new f(n,i),r=this.decompose(),a=t.decompose(),s=r.translate,c=a.translate,u=r.scale;return o.translate(s.x+(c.x-s.x)*e,s.y+(c.y-s.y)*e),o.rotate(r.rotation+(a.rotation-r.rotation)*e),o.scale(u.x+(a.scale.x-u.x)*e,u.y+(a.scale.y-u.y)*e),o._x()},decompose:function(t){var e=this,n=e.a,i=e.b,o=e.c,r=e.d,a=Math.acos,s=Math.atan,c=Math.sqrt,u=Math.PI,h={x:e.e,y:e.f},l=0,f={x:1,y:1},y={x:0,y:0},p=n*r-i*o;if(t)n?(y={x:s(o/n),y:s(i/n)},f={x:n,y:p/n}):y.x=i?(l=.5*u,f={x:i,y:p/i},s(r/i)):(f={x:o,y:r},.25*u);else if(n||i){var x=c(n*n+i*i);l=0<i?a(n/x):-a(n/x),f={x:x,y:p/x},y.x=s((n*o+i*r)/(x*x))}else if(o||r){var v=c(o*o+r*r);l=.5*u-(0<r?a(-o/v):-a(o/v)),f={x:p/v,y:v},y.y=s((n*o+i*r)/(v*v))}else f={x:0,y:0};return{translate:h,rotation:l,scale:f,skew:y}},determinant:function(){return this.a*this.d-this.b*this.c},applyToPoint:function(t,e){var n=this;return{x:t*n.a+e*n.c+n.e,y:t*n.b+e*n.d+n.f}},applyToArray:function(t){var e,n,i=0,o=[];if("number"==typeof t[0])for(n=t.length;i<n;)e=this.applyToPoint(t[i++],t[i++]),o.push(e.x,e.y);else for(;e=t[i++];)o.push(this.applyToPoint(e.x,e.y));return o},applyToTypedArray:function(t,e){for(var n,i=0,o=t.length,r=e?new Float64Array(o):new Float32Array(o);i<o;)n=this.applyToPoint(t[i],t[i+1]),r[i++]=n.x,r[i++]=n.y;return r},applyToContext:function(t){var e=this;return t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),e},applyToElement:function(t,e){var n=this;return n._px||(n._px=n._getPX()),t.style[n._px]=e?n.toCSS3D():n.toCSS(),n},applyToObject:function(t){var e=this;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,e},isIdentity:function(){var t=this;return t._q(t.a,1)&&t._q(t.b,0)&&t._q(t.c,0)&&t._q(t.d,1)&&t._q(t.e,0)&&t._q(t.f,0)},isInvertible:function(){return!this._q(this.determinant(),0)},isValid:function(){return!(this.a*this.d)},isEqual:function(t){var e=this,n=e._q;return n(e.a,t.a)&&n(e.b,t.b)&&n(e.c,t.c)&&n(e.d,t.d)&&n(e.e,t.e)&&n(e.f,t.f)},clone:function(t){return new f(t?null:this.context).multiply(this)},toArray:function(){var t=this;return[t.a,t.b,t.c,t.d,t.e,t.f]},toTypedArray:function(t){var e=t?new Float64Array(6):new Float32Array(6),n=this;return e[0]=n.a,e[1]=n.b,e[2]=n.c,e[3]=n.d,e[4]=n.e,e[5]=n.f,e},toCSS:function(){return"matrix("+this.toArray()+")"},toCSS3D:function(){var t=this;return"matrix3d("+t.a+","+t.b+",0,0,"+t.c+","+t.d+",0,0,0,0,1,0,"+t.e+","+t.f+",0,1)"},toJSON:function(){var t=this;return'{"a":'+t.a+',"b":'+t.b+',"c":'+t.c+',"d":'+t.d+',"e":'+t.e+',"f":'+t.f+"}"},toString:function(t){var e=this;return t=t||4,"a="+e.a.toFixed(t)+" b="+e.b.toFixed(t)+" c="+e.c.toFixed(t)+" d="+e.d.toFixed(t)+" e="+e.e.toFixed(t)+" f="+e.f.toFixed(t)},toCSV:function(){return this.toArray().join()+"\r\n"},toDOMMatrix:function(){var t=null;return"DOMMatrix"in window&&((t=new DOMMatrix).a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.e=this.e,t.f=this.f),t},toSVGMatrix:function(){var t=this,e=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=null;return e&&((n=e.createSVGMatrix()).a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f),n},_q:function(t,e){return Math.abs(t-e)<1e-14},_x:function(){var t=this;return t.context&&t.context.setTransform(t.a,t.b,t.c,t.d,t.e,t.f),t._st&&(t._st[t._px]=t.useCSS3D?t.toCSS3D():t.toCSS()),t}},e.Matrix=f}])});